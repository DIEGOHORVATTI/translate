{"version":3,"sources":["../../src/middlewares/jwt.ts"],"sourcesContent":["import { HTTPError } from '@/errors'\nimport { endpoint } from '@/middlewares'\n\nimport { verify } from 'jsonwebtoken'\n\nimport { User } from '@/models/User'\n\nexport const jwt = endpoint(async (req, res, next) => {\n  const { authorization } = req.headers\n\n  if (!authorization || !authorization.startsWith('Bearer ')) {\n    throw new HTTPError('Unauthorized', 401)\n  }\n\n  const token = authorization.slice('Bearer '.length)\n\n  try {\n    const decoded = verify(token, process.env.JWT_SECRET) as {\n      email: string\n      id: string\n    }\n\n    const user = await User.findById(decoded.id)\n\n    if (!user) {\n      return res.status(401).json({\n        message: 'Usu√°rio inexistente'\n      })\n    }\n\n    req.user = user\n\n    return next()\n  } catch (_error) {\n    throw new HTTPError('Unauthorized', 401)\n  }\n})\n"],"names":["jwt","endpoint","req","res","next","authorization","headers","startsWith","HTTPError","token","slice","length","decoded","verify","process","env","JWT_SECRET","user","User","findById","id","status","json","message","_error"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPa;6BACD;8BAEF;sBAEF;AAEd,MAAMA,MAAMC,IAAAA,qBAAQ,EAAC,OAAOC,KAAKC,KAAKC;IAC3C,MAAM,EAAEC,aAAa,EAAE,GAAGH,IAAII,OAAO;IAErC,IAAI,CAACD,iBAAiB,CAACA,cAAcE,UAAU,CAAC,YAAY;QAC1D,MAAM,IAAIC,iBAAS,CAAC,gBAAgB;IACtC;IAEA,MAAMC,QAAQJ,cAAcK,KAAK,CAAC,UAAUC,MAAM;IAElD,IAAI;QACF,MAAMC,UAAUC,IAAAA,oBAAM,EAACJ,OAAOK,QAAQC,GAAG,CAACC,UAAU;QAKpD,MAAMC,OAAO,MAAMC,UAAI,CAACC,QAAQ,CAACP,QAAQQ,EAAE;QAE3C,IAAI,CAACH,MAAM;YACT,OAAOd,IAAIkB,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAC1BC,SAAS;YACX;QACF;QAEArB,IAAIe,IAAI,GAAGA;QAEX,OAAOb;IACT,EAAE,OAAOoB,QAAQ;QACf,MAAM,IAAIhB,iBAAS,CAAC,gBAAgB;IACtC;AACF"}